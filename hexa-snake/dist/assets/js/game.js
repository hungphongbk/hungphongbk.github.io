var extend=function(t,e){function n(){this.constructor=t}for(var r in e)hasProp.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty,modulo=function(t,e){return(+t%(e=+e)+e)%e};!function(t,e,n,r){var i,o,s,a,u,h,c,l,f,p;return o=30,s=.9,p=function(){function t(){}var e;return e=.001,t.eq=function(t,n){return Math.abs(t-n)<e},t.randomInteger=function(t){return Math.floor(Math.random()*(t+1))},t.squareDistance=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)},t.distance=function(e,n){return Math.sqrt(t.squareDistance(e,n))},t.testIfEquilateralTriangle=function(e,n,r){return t.eq(t.distance(e,n),t.distance(n,r))&&t.eq(t.distance(n,r),t.distance(r,e))&&t.eq(t.distance(r,e),t.distance(e,n))},t.testIfRightTriangle=function(e,n,r){return t.eq(t.squareDistance(e,n)+t.squareDistance(e,r),t.squareDistance(n,r))},t.log=function(t,e){return null==e&&(e="black"),console.log("%c"+t,"color: "+e+";")},t.logSuccess=function(t){return this.log(t,"Green")},t.logError=function(t){return this.log(t,"Red")},t.logInfo=function(t){return this.log(t,"DodgerBlue")},t}(),a=function(){function t(t,e){this.x=t,this.y=e,this.map=u.instance,this.sprite=null}return t.prototype.renderPosW=function(){return this.map.unitSize*this.x},t.prototype.renderPosH=function(){return this.map.unitSize*this.y},t.prototype.next=function(t){var e,n;switch(n=this.map.unitW,e=this.map.unitH,t){case 0:return this.map.find(this.x+n/2,this.y-e);case 1:return this.map.find(this.x+n,this.y);case 2:return this.map.find(this.x+n/2,this.y+e);case 3:return this.map.find(this.x-n/2,this.y+e);case 4:return this.map.find(this.x-n,this.y);case 5:return this.map.find(this.x-n/2,this.y-e)}},t.prototype.toString=function(){return"Hexagon("+this.x.toFixed(7)+", "+this.y.toFixed(3)+")"},t}(),u=function(){function t(){}var e,n;return n=null,e=function(){function t(t,e,n){this.unitSize=n,this.unitW=Math.sqrt(3)/2,this.unitH=.75,this.width=Math.floor(t/this.unitSize),this.height=Math.floor(e/this.unitSize),this.hexagonArray=[]}return t.prototype.initHexagonArray=function(){var t,e,n;for(this.hexagonArray=[],n=3*this.unitW/2,e=this.unitH,t=!0;;)if(this.hexagonArray.push(new a(n,e)),n+=this.unitW,n>this.width-this.unitW/2&&(e+=this.unitH,t=!t,n=t?3*this.unitW/2:this.unitW),!(e<this.height-this.unitH))break},t.prototype.find=function(t,e){var n,r,i,o,s;for(o=this.hexagonArray,r=0,i=o.length;i>r;r++)if(n=o[r],p.eq(t,n.x)&&p.eq(e,n.y)){s=n;break}return s},t.prototype.test=function(){var t;return t=this.hexagonArray[4],console.log(t),t=t.next(3),console.log(t),t=t.next(3),console.log(t),t=t.next(1),console.log(t)},t.prototype.testHexagonMapAccuracy=function(){var t,e,n,r;p.logInfo("Test HexagonMap accuracy"),t=function(t){return function(){var e,n,r;return e=t.hexagonArray[p.randomInteger(t.hexagonArray.length-1)],n=e.next(2),r=e.next(3),[e,n,r]}}(this),n=function(){var e,n,r,i,o,s;for(i=t(),e=i[0],n=i[1],r=i[2];!(e&&n&&r);)o=t(),e=o[0],n=o[1],r=o[2];return p.logInfo("Test Equilateral"),console.log("Selected 3 points: "+e.toString()+" "+n.toString()+" and "+r.toString()),s=p.testIfEquilateralTriangle(e,n,r),s?p.logSuccess("Test result: true"):p.logError("Test result: false"),s},e=function(e){return function(){var e,n,r,i,o,s;for(o=t(),e=o[0],n=o[1],r=o[2];!(e&&n&&r);)s=t(),e=s[0],n=s[1],r=s[2];return i=r.next(4),[e,n,i]}}(this),r=function(){var t,n,r,i,o,s;for(p.logInfo("Test Right Triangle"),i=e(),t=i[0],n=i[1],r=i[2];!(t&&n&&r);)o=e(),t=o[0],n=o[1],r=o[2];return console.log("Selected 3 points: "+t.toString()+" "+n.toString()+" and "+r.toString()),s=p.testIfRightTriangle(t,n,r),s?p.logSuccess("Test result: true"):p.logError("Test result: false"),s},n()&&r()?p.logSuccess("Summary: success"):p.logError("Summary: fail")},t}(),t.config=function(t,r,i){return null==i&&(i=20),n=new e(t,r,i),n.initHexagonArray(),p.logInfo("HexaGon Map initialized"),console.log("- size "+t+" x "+r+" and unitSize = "+i),console.log("- number of hexa tiles is "+n.hexagonArray.length)},Object.defineProperty(t,"instance",{get:function(){return n}}),t}(),i=function(t){function e(t,n,r){var i,o;null==r&&(r=0),e.__super__.constructor.call(this,t,n.renderPosW(),n.renderPosH(),"snake"),this.pushType(r),i=u.instance,o=i.unitSize/208*s,this.scale.setTo(o,o),this.anchor.setTo(.5,.5),this.smoothed=!0,n.sprite=this}return extend(e,t),e.TILE_BACKGROUND=0,e.TILE_WALL=1,e.TILE_SNAKEBODY=4,e.TILE_SNAKEHEAD=2,e.TILE_FOOD=3,e.prototype.pushType=function(t){return this.frame=t},e.prototype.popType=function(){return this.frame=0},e}(n.Sprite),h=function(){function t(t){this.game=t,this.length=10,this.direction=1,this.map=u.instance,this._array=[],this.onEat=function(){}}var e,n,r;return r=!1,t.prototype.init=function(){var t,n,r;for(t=n=0,r=this.length-1;r>=0?r>=n:n>=r;t=r>=0?++n:--n)this._array.push(this.map.hexagonArray[t]);return e(this)},t.prototype.move=function(){var t,o,s,a;return a=this._array,o=a[0],t=a[a.length-1],o.sprite.popType(),r?r=!r:this._array.shift(),s=t.next(this.direction),s||(s=n(this,t)),s.sprite.frame===i.TILE_FOOD&&(r=!0),this._array.push(s),e(this)},t.prototype.isEat=function(){return r},t.prototype.setMoveClockwise=function(){return this.direction=(this.direction+1)%6,console.log("move "+this.direction)},t.prototype.setMoveCounterClockwise=function(){return this.direction=modulo(this.direction-1,6)},n=function(t,e){var n,r;if(r=modulo(t.direction+3,6),p.logInfo("Reach boundary. Reverse with direction="+r+" and current head is "+e),n=e.next(r),!n)return n;for(;null!=n;)e=n,n=e.next(r);return p.logInfo("New head is "+e),e},e=function(t){var e,n,r,o,s;for(r=t._array.length-1,s=[],e=n=0,o=r;o>=0?o>=n:n>=o;e=o>=0?++n:--n)s.push(t._array[e].sprite.pushType(e===r?i.TILE_SNAKEBODY:i.TILE_SNAKEHEAD));return s},t}(),l=function(t){function e(t){this.game=t,e.__super__.constructor.call(this,this.game),this.textStyle={font:"90px HelveticaNeue",align:"center",fill:"#888888"},this.timerText=null,this.timer=null,this.timerEvent=null,this.seconds=1}return extend(e,t),e.prototype.preload=function(){return u.config(this.game.width,this.game.height,o),u.instance.testHexagonMapAccuracy()},e.prototype.create=function(){return this.timerText=this.game.add.text(this.game.world.centerX,this.game.world.centerY,"3",this.textStyle),this.timerText.anchor.setTo(.5,.5),this.timer=this.game.time.create(),this.timerEvent=this.timer.add(n.Timer.SECOND*this.seconds,this.endTimer,this),this.timer.start()},e.prototype.endTimer=function(){return this.timer.stop(),this.game.state.start("Play")},e.prototype.render=function(){return this.timer.running?this.timerText.setText(Math.ceil((this.timerEvent.delay-this.timer.ms)/1e3)):void 0},e}(n.State),f=function(t){function e(t){e.__super__.constructor.call(this,t),this.snake=null,this.food=null}var n,r,o,s;return extend(e,t),r=0,o=null,s=0,e.prototype.preload=function(){return this.game.load.atlasJSONArray("snake","dist/assets/images/HexaSprites.png","dist/assets/images/HexaSprites.json")},e.prototype.create=function(){var t,e,r,o;for(o=u.instance.hexagonArray,t=0,e=o.length;e>t;t++)r=o[t],game.add.existing(new i(game,r,0));return this.snake=new h(game),this.snake.init(),n(this)},e.prototype.update=function(){return s=game.input.keyboard.isDown(Phaser.Keyboard.LEFT)?2:game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)?1:s,r++,r%12===0?(1===s?this.snake.setMoveClockwise():2===s&&this.snake.setMoveCounterClockwise(),this.snake.move(),this.snake.isEat()&&n(this),s=0):void 0},n=function(t){var e;for(e=u.instance,t.food=e.hexagonArray[p.randomInteger(e.hexagonArray.length)];0!==t.food.sprite.frame;)t.food=e.hexagonArray[p.randomInteger(e.hexagonArray.length)];t.food.sprite.frame=i.TILE_FOOD},e}(n.State),c=function(t){function e(){e.__super__.constructor.apply(this,arguments),this.initStates()}return extend(e,t),e.prototype.initStates=function(){return this.state.add("Loading",l),this.state.add("Play",f),this.state.start("Loading")},e}(n.Game),function(){var t,e,n;return t="GameController",n=function(t,e){return t.trim()+" as "+e.trim()},e=r.module("SnakeApp",["ui.router","ngAnimate"]),e.config(["$stateProvider","$urlRouterProvider",function(e,r){e.state("red",{url:"/red",templateUrl:"red.html"}).state("green",{url:"/green",templateUrl:"green.html",controller:n(t,"game")}).state("blue",{url:"/blue",templateUrl:"blue.html"}),r.otherwise("/red")}]),e.controller(t,["$scope","$state",function(t){return function(e,n){t.game=null,t.initGame=function(e,n){return t.game=new c(e,n,Phaser.AUTO,"snakeGame",null,!0),console.log(t.game)},e.initGame=t.initGame,e.$on("$destroy",function(){return t.game.destroy()})}}(this)]),e.directive("game",["$injector",function(t){return{scope:{gameName:"@",onInit:"&"},template:"<div class='game-screen'></div>",replace:!0,compile:function(t){return{pre:function(e){t.attr("id",e.gameName+"Game")},post:function(e,n,r,i){var o,s;o=parseInt(t.height(),10),s=parseInt(t.width(),10),e.onInit()(s,o)}}}}}])}()}(jQuery,window,Phaser,angular);
//# sourceMappingURL=../maps/game.js.map
